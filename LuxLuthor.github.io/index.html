<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES Decryption</title>
</head>
<body>
    <h2>Odszyfrowanie AES</h2>
    <p>Wprowadź hasło, aby odszyfrować wiadomość:</p>
    <input type="password" id="password" placeholder="Hasło">
    <button onclick="decryptMessage()">Odszyfruj</button>
    <p id="result"></p>

    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    <script>
        function getParameterByName(name) {
            const url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
            const results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        function decryptMessage() {
            const password = document.getElementById("password").value;
            const cipherTextBase64 = getParameterByName('cipher');

            if (cipherTextBase64 && password) {
                try {
                    const cipherParams = CryptoJS.lib.CipherParams.create({
                        ciphertext: CryptoJS.enc.Base64.parse(cipherTextBase64)
                    });

                    const decrypted = CryptoJS.AES.decrypt(cipherParams, CryptoJS.enc.Utf8.parse(password), {
                        mode: CryptoJS.mode.ECB,
                        padding: CryptoJS.pad.Pkcs7
                    });

                    const plainText = decrypted.toString(CryptoJS.enc.Utf8);

                    if (plainText) {
                        document.getElementById("result").textContent = "Odszyfrowana wiadomość: " + plainText;
                    } else {
                        document.getElementById("result").textContent = "Nie udało się odszyfrować wiadomości. Sprawdź hasło.";
                    }
                } catch (error) {
                    document.getElementById("result").textContent = "Błąd przy odszyfrowywaniu: " + error.message;
                }
            } else {
                document.getElementById("result").textContent = "Proszę podać hasło i upewnić się, że szyfrogram jest dostępny w parametrze URL.";
            }
        }
    </script>
</body>
</html>
